<!DOCTYPE html>
<html>
  <head>
    <title>Βημα 6 : Δημιουργία Amazon S3 account</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/index.css">
    
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
  </head>

  <body>

    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary" id="sideNav">

        <a class="navbar-brand" href="../index.html">
            <span>Learn Spring</span>
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false">
                <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="spring.html">Spring</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-container.html">Spring IoC Container</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="dependency-injection.html">Dependency Injection</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="annotations.html">Annotations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step2.html">Βημα 2</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step3.html">Βημα 3</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step4.html">Βημα 4</a>
                </li>    
                <li class="nav-item">
                    <a class="nav-link" href="step5.html">Βημα 5</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step6.html">Βημα 6</a>
                </li>  

            </ul>
        </div>
    </nav>

    <div class="container-fluid content">

        <section class="mt-5 px-5">
            <h1 class="text-center">Annotations</h1>

            <h3 class="mt-4">Core Spring Framework Annotations</h3>

            <h5 class="mt-4">@Autowired</h5>

            <p>Το autowiring είναι ένα μέσο, όπου επιτρέπουμε στο Spring να ικανοποιήσει αυτόματα τις εξαρτήσεις ενός bean, βρίσκοντας
                άλλα beans στο application context, τα οποία ταιριάζουν στις ανάγκες του bean. Για να υποδείξουμε στο Spring, ότι πρέπει,
                να πραγματοποιηθεί autowiring, χρησιμοποιηούμε το annotation @Autowired είτε σε ένα field, είτε σε ένα κατασκευαστή.
            </p>

            <h5 class="mt-4">@Configuration</h5>

            <p>Με το annotation @Configuration ορίζουμε, ότι η κλάση μας θα είναι configuration class και ότι θα περιέχει λεπτομέρειες,
                σχετικά με τα αντικείμενα, τα οποία θα δημιουργηθούν στο Spring application context.

                <pre>
                    <code>
                        <span class="annotation">@Configuration</span>
		                <span class="keyword">public class</span> AmazonS3Configuration{

	                    }
                    </code>
                </pre>
            </p>

            <h5 class="mt-4">@Bean</h5>

            <p>Το annotation @Bean χρησιμοποείται σε επίπεδο μεθόδου και υποδεικνύει στο Spring, ότι η μέθοδος αυτή θα επιστρέψει ένα αντικείμενο, το οποίο θα πρέπει, να εγγραφεί
                ως bean στο Spring application Context με το όνομα awsS3AudioBucket.

                <pre>
                    <code>
                        <span class="annotation">@Configuration</span>
		                <span class="keyword">public class</span> AmazonS3Configuration{

                        <span class="annotation">@Bean</span>(name = <span class="string">"awsS3AudioBucket"</span>)
                        <span class="keyword">public String</span>  getAWSS3AudioBucket() {
                        <span class="keyword">return</span> awsS3AudioBucket;
                          }

	                    }
                    </code>
                </pre>
            </p>

            <h5 class="mt-4">@ComponentScan</h5>

            <p class="mb-5">Το annotation @ComponentScan επιτρέπει στο Spring, να αναζητάει annotated components.</p>
            

            <h3 class="mt-5">Spring Framework Stereotype Annotations</h3>

            <h5 class="mt-4">@Component</h5>

            <p>Χρησιμοποιούμε το annotation @Component, για να δηλώσουμε ότι η κλάση είναι ένα Spring component. Το annotation σημειώνει
                την κλάση ως ένα bean, ώστε ο μηχανισμός ανίχνευσης components του Spring, να τα προσθέσει στο application context.

                <pre>
                    <code>                        
                        <span class="annotation">@Component</span>
                        <span class="keyword">public class</span> EmailServiceImp <span class="keyword">implements</span>  EmailService{

                        }
                    </code>
                </pre>
            </p>

            <h5 class="mt-4">@Repository</h5>

            <p>Το annotation είναι μια πιο ειδική περίπτωση του annotation @Component και χρησιμοποείται για κλάσεις, που έχουν πρόσβαση
                στη βάση δεδομένων.

                <pre>
                    <code>                        
                        <span class="annotation">@Repository
                        <span class="keyword">public interface</span> ProductRepository <span class="keyword">extends</span>  JpaRepository<Product, Integer>{

                        }
                    </code>
                </pre>
            </p>

            <h5 class="mt-4">@Service</h5>

            <p>Το annotation είναι μια πιο ειδική περίπτωση του annotation @Component και χρησιμοποείται για κλάσεις, που ανήκουν στο 
                service layer.

                <pre>
                    <code>                        
                        <span class="annotation">@Service(<span class="string">"productService"</span>)</span>
                        <span class="annotation">@Transactional</span>
                        <span class="keyword">public class</span> ProductServiceImpl <span class="keyword"> implements</span> ProductService{

                        }
                    </code>
                </pre>
            </p>

            <h5 class="mt-4">@Controller</h5>

            <p class="mb-5">Το annotation είναι μια πιο ειδική περίπτωση του annotation @Component, σημειώνει την κλάση ως Spring Web MVC Controller και
                εισάγεται στο Spring IoC Container.

                <pre>
                    <code>                        
                        <span class="annotation">@Controller</span>
                        <span class="keyword">public class</span> RoutesController {

                        }
                    </code>
                </pre>
            </p>

            <h3 class="mt-5">Spring Boot Annotations</h3>

            <h5 class="mt-4">@SpringBootApplication</h5>

            <p>Το annotation @SpringBootApplication προσθέτει τα annotations @Configuration, @EnableAutoConfiguration και @ComponentScan.
                χρησιμοποείται στην κύρια κλάση της εφαρμογής και πρέπει, να βρίσκεται στο base package. Για παράδειγμα, αν η κλάση με το
                @annotation τοποθετηθεί στο package springeshop, τότε το spring θα κάνει component scan μόνο στα subpackages, όπως springeshop.configuration
                και springeshop.model . 

                <pre>
                    <code>                        
                        <span class="annotation">@EnableAsync</span>
                        <span class="annotation">@SpringBootApplication</span>(scanBasePackages={<span class="string">"springeshop"</span>})
                        <span class="keyword">public class</span> SpringEshopApplication {

                        }
                    </code>
                </pre>
            </p>

            <h5 class="mt-4">@EnableAutoConfiguration</h5>

            <p class="mb-5">Το annotation @EnableAutoConfiguration τοποθετείται στην κύρια κλάση της εφαρμογής και ενεργοποιεί τον μηχανισμό
                auto-configuration του Spring. Ο μηχανισμός αυτός προσπαθεί, να ρυθμίσει αυτόματα την εφαρμογή, βασισμένος στα jar dependencies
                ,που έχουμε προσθέσει στο classpath.
            </p>

            <h3 class="mt-5">Spring MVC and REST Annotations</h3>

            <h5 class="mt-4">@RestController</h5>

            <p>Το annotation αυτό χρησιμοποείται σε επίπεδο κλάσης. Σημειώνει την κλάση ως έναν controller, ο οποίος θα επιστρέφει ένα
                domain oject αντί για ένα view. Δηλαδή δεν στέλνεται html ως απάντηση, αλλά ένα domain object σε μορφή, την οποία καταλαβαίνει
                ο καταναλωτής όπως JSON.

                <pre>
                    <code>                        
                        <span class="annotation">@RestController</span>
                        <span class="annotation">@RequestMapping(<span class="string">"/api"</span></span>)
                        <span class="keyword">public class</span> CategoryApiController {

                        }
                    </code>
                </pre>
            </p>

            <h5 class="mt-4">@RequestMapping</h5>

            <p>Το annotation αυτό χρησιμοποείται σε επίπεδο κλάσης και μεθόδου. Αντιστοιχίζει ένα αίτημα HTTP σε μια συγκεκριμένη μέθοδο, 
                η οποία θα το χειριστεί. Όταν το annotation χρησιμοποείται σε επίπεδο κλάσης, ορίζει το βασικό URL, για το οποίο θα χρησιμοποιηθεί
                ο controller. Η κάθε μέθοδος θα αντιστοιχίζεται σε διαφορετικό URL. Η παράμετρος method δηλώνει τι τύπου θα είναι το HTTP request, το
                οποίο θα χειριστεί η μέθοδος. Για παράδειγμα, όταν πραγματοποιηθεί GET HTTP αίτημα στο URL
                http://localhost:8080/api/deals, θα εκτελεστεί η μέθοδος getDeals().

                <pre>
                    <code>                        
                        
                        <span class="annotation">@RestController</span>
                        <span class="annotation">@RequestMapping(<span class="string">"/api"</span></span>)
                        <span class="keyword">public class</span> DealApiController {

                            &emsp; <span class="annotation">@Autowired</span>
                            &emsp; <span class="keyword">private</span> DealService dealService;

                            &emsp; <span class="annotation">@Autowired</span>
                            &emsp; <span class="keyword">private</span> DealImageService dealImageService;
                            
                            &emsp; <span class="keyword">public static final</span> Logger logger = LoggerFactory.getLogger(DealApiController.class);

                            &emsp; <span class="annotation">@RequestMapping( value = <span class="string">"/deals"</span></span>, method = RequestMethod.GET)
	                        &emsp; <span class="keyword">public</span> ResponseEntity&#60;?&#62; getDeals(){

                                &emsp;&emsp;&emsp; List<Deal> deals = dealService.findAllDeals();
		
                                &emsp;&emsp;&emsp; <span class="keyword">if</span>(deals.isEmpty()){
                                &emsp;&emsp;&emsp; &emsp; <span class="keyword">return new</span> ResponseEntity&#60;&#62;(HttpStatus.NO_CONTENT);
                                &emsp;&emsp;&emsp; }

                                &emsp;&emsp;&emsp; <span class="keyword">for</span>(Deal deal : deals){
                                &emsp;&emsp;&emsp;&emsp; DealImage dealImage = dealImageService.findByDeal(deal);
                                &emsp;&emsp;&emsp;&emsp; deal.setImageUrl(dealImage.getUrl());
                                &emsp;&emsp;&emsp; }

                                &emsp;&emsp;&emsp; <span class="keyword">return new</span> ResponseEntity&#60;List&#60;Deal&#62;&#62;(deals, HttpStatus.OK);
                            &emsp; }
                        }
                    </code>
                </pre>
            </p>

            <h5 class="mt-4">@PathVariable</h5>

            <p>Το annotation χρησιμοποείται στις παραμέτρους μεθόδου. Χειρίζεται δυναμικές αλλαγές στο URL, όπου ένα κομμάτι του URL λειτουργεί
                ως παράμετρος. Για παράδειγμα, η παρακάτω μέθοδος getProductByName() θέλουμε, να επιστρέφει το σωστό προιόν, ανάλογα με το όνομα του προιόντος στο url.
                Όταν ο client θέλει το προιόν με όνομα apivita-shampoo-dry-dandruff-250ml, κάνει ένα GET HTTP request στο url 
                http://localhost:8080/api/products/apivita-shampoo-dry-dandruff-250ml και η παράμετρος name της μεθόδου παίρνει την τιμή
                "apivita-shampoo-dry-dandruff-250ml".
                <pre>
                    <code>                        
                        <span class="annotation">@RequestMapping( value = <span class="string">"/products/{name}"</span></span>, method = RequestMethod.GET)
                        <span class="keyword">public</span> ResponseEntity&#60;?&#62; getProductByName(@PathVariable(<span class="string">"name"</span>) String name) {
                            
                            &emsp;&emsp;&emsp;logger.info(<span class="string">"Fetching Product with name {}"</span>, name);
                            &emsp;&emsp;&emsp;Product product = productService.findByName(name);

                            &emsp;&emsp;&emsp;<span class="keyword">if</span>(product == null){
                            &emsp; &emsp;&emsp;&emsp;    logger.error(<span class="string">"Product with name {} not found."</span>, name);
                            &emsp; &emsp;&emsp;&emsp;    <span class="keyword">return new</span> ResponseEntity&#60;&#62;(new ErrorMessage(<span class="string">"Product with name {}"</span> + name + <span class="string">" not found"</span>), HttpStatus.NOT_FOUND);
                            &emsp;&emsp;&emsp;}

                            &emsp;&emsp;&emsp;ProductImage productImage = productImageService.findByProductId(product.getId());
                            &emsp;&emsp;&emsp;product.setSmallImageUrl(productImage.getSmallImageurl());
                            &emsp;&emsp;&emsp;product.setLargeImageUrl(productImage.getLargeImageurl());
                            &emsp;&emsp;&emsp;product.setVerySmallImageUrl(productImage.getVerySmallImageurl());

                            &emsp;&emsp;&emsp;int productQuantity = inventoryService.findProductQuantity(product.getId());
                            &emsp;&emsp;&emsp;product.setQuantity(productQuantity);

                            &emsp;&emsp;&emsp;<span class="keyword">return new</span> ResponseEntity&#60;Product&#62;(product, HttpStatus.OK);
                        }
                    </code>
                </pre>
            </p>

            <h5 class="mt-4">@RequestParam</h5>

            <p> Το annotation χρησιμοποείται στις παραμέτρους μεθόδου. Αντιστοιχίζει τις παραμέτρους που στέλνει ο client, συνήθως με GET request,
                με παραμέτρους της μεθόδου , η οποία θα χειριστεί το αίτημα. Όταν o client θέλει τα brands της κατηγορίας shampoos, κάνει ένα GET
                HTTP request στο URL http://localhost:8080/api/brands?category=shampoos και η παράμετρος category της μεθόδου getCategoryBrands() παίρνει την τιμή 
                "shampoos". 
                <pre>
                    <code>
                            <span class="annotation">@RequestMapping( value = <span class="string">"/brands"</span></span>, method = RequestMethod.GET)
                            <span class="keyword">public</span> ResponseEntity&#60;?&#62; getCategoryBrands(@RequestParam(value =<span class="string">"category"</span>, required = false String category) {

                            &emsp;&emsp;&emsp; Category requestedCategory = categoryService.findByName(getCorrectCategoryName(category));

                            &emsp;&emsp;&emsp;<span class="keyword">if</span>(requestedCategory == null){
                            &emsp; &emsp;&emsp;&emsp; <span class="keyword">return new</span> ResponseEntity&#60;&#62;(new ErrorMessage(<span class="string">"Category does not exist"</span>), HttpStatus.BAD_REQUEST);
                            &emsp;&emsp;&emsp;}

                            &emsp;&emsp;&emsp; List&#60;Brand&#62 brands = productService.findCategoryBrands(requestedCategory.getId());

                            &emsp;&emsp;&emsp;<span class="keyword">if</span>(brands.isEmpty()){
                            &emsp; &emsp;&emsp;&emsp; <span class="keyword">return new</span> ResponseEntity&#60;&#62;(HttpStatus.NO_CONTENT);
                            &emsp;&emsp;&emsp;}

                            &emsp;&emsp;&emsp;brands.sort((Brand brand1, Brand brand2) -> brand1.getName().compareTo(brand2.getName()));

                            &emsp;&emsp;&emsp;<span class="keyword">return new</span> ResponseEntity&#60;List&#60;Brand&#62;&#62;(brands, HttpStatus.OK);
                    </code>
                </pre>
            </p>

        </section>

        
    </div>

  </body>
</html>
