<!DOCTYPE html>
<html>
  <head>
    <title>Spring MVC</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/index.css">
    
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
  </head>

  <body>

    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary" id="sideNav">

        <a class="navbar-brand" href="../index.html">
            <span>Learn Spring</span>
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false">
                <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="spring.html">Spring</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-container.html">Spring IoC Container</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-beans.html">Spring Beans</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="dependency-injection.html">Dependency Injection</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="annotations.html">Annotations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-boot.html">Spring Boot</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-mvc.html">Spring MVC</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step2.html">Βημα 2</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step3.html">Βημα 3</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step4.html">Βημα 4</a>
                </li>    
                <li class="nav-item">
                    <a class="nav-link" href="step5.html">Βημα 5</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step6.html">Βημα 6</a>
                </li>  

            </ul>
        </div>
    </nav>

    <div class="container-fluid content">

        <h1 class="text-center">Spring MVC</h1>

        <section class="intro">

            <p>To Spring Web MVC framework παρέχει το μοντέλο αρχικτονικής Model-View-Controller(MVC) και έτοιμα components, ώστε
                να δημιουργήσουμε ευέλικτες και με χαμηλή σύζευξη εφαρμογές To MVC pattern διαχωρίζει τα διάφορα κομμάτια της εφαρμογής 
                (input logic, business logic και UI logic) και παρέχει χαμηλή σύζευξη μεταξύ αυτών των στοιχείων.</p>

            <ul>
                <li>Το <span class="bold">Model</span> ενθυλακώνει τα <span class="bold">δεδομένα της εφαρμογής</span> και γενικά αποτελείται από τα POJOs.</li>
                <li>Το <span class="bold">View</span> είναι υπεύθυνο για την <span class="bold">εμφανίση των δεδομένω του Model</span> και γενικά το τελικό προιόν που παράγει, είναι HTML, 
                    την οποία μπορεί, να μεταφράσει ο browser του client.
                </li>
                <li>Ο <span class="bold">Controller</span> είναι υπεύθυνος για την <span class="bold">διαχείριση των αιτημάτων</span> του χρήστη, 
                    την <span class="bold">δημιουργία του κατάλληλου Model</span>, το οποίο <span class="bold">περνάει στο View</span>, έτσι ώστε να το εμφανίσει.
                </li>
            </ul>

            <img class="img-fluid d-block mx-auto my-5" src="../img/mvc-diagram.png" alt="Mvc Diagram">
            
        </section>

        <section class="dispatcher-servlet">
            <h5>Dispatcher Servlet</h5>

            <p>Το Spring MVC, όπως και άλλα web frameworks, είναι σχεδιασμένο γύρω από το front controller pattern, όπου ένα κεντρικό Servlet
                , το Dispatcher Servlet, παρέχει έναν μοιραζόμενο αλγόριθμο για την επεξεργασία των αιτημάτων, ενώ η πραγματική δουλειά
                ανατίθεται και πραγματοποιείται απο ρυθμιζόμενα components.
            </p>

            <img class="img-fluid d-block mx-auto my-5" src="../img/dispatcher-servlet.png" alt="Dispatcher Servlet">

            <p>Όταν γίνεται ένα HTTP αίτημα στο <span class="highlight">DispatcherServlet</span>, πραγματοποιείται η εξής ακολουθία γεγονότων:</p>

            <ol>
                <li>Όταν λάβει ένα HTTP request, το <span class="highlight">DispatcherServlet</span> συμβουλεύεται το 
                    <span class="highlight">HandlerMapping</span>, για να καλέσει τον κατάλληλο <span class="highlight">Controller</span>.</li>
                <li>O <span class="highlight">Controller</span> παίρνει το αίτημα και καλεί την κατάλληλη μέθοδο, που θα το διαχειριστεί, ανάλογα με την HTTP μέθοδο. 
                    Η μέθοδος του <span class="highlight">Controller</span> θα δημιουργήσει τα δεδομένα του <span class="highlight">Model</span>, 
                    σύμφωνα με το business logic και θα επιστρέψει το όνομα του <span class="highlight">DispatcherServlet</span>View στο <span class="highlight">DispatcherServlet</span>.
                </li>
                <li>Το <span class="highlight">DispatcherServlet</span> περνάει το λογικό όνομα του <span class="highlight">View</span> στον <span class="highlight">ViewResolver</span> και 
                    αυτος επιστρέφει την πραγματική υλοποίηση του <span class="highlight">View</span>.
                </li>
                <li>
                    Το <span class="highlight">DispatcherServlet</span> περνάει τα δεδομένα στο <span class="highlight">View</span> και επιστρέφει την απάντηση στον browser του client.
                </li>
            </ol>

            <p>Για να δημιουργήσουμε το DispatcherServlet, χρειάζεται XML ή Java Configuration. Παρακάτω δίνεται το Java configuration.</p>

            <pre>
                <code>
                        <span class="keyword">public class</span> MyWebAppInitializer  <span class="keyword">extends</span> AbstractAnnotationConfigDispatcherServletInitializer {

                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Override</span>
                            &emsp;&emsp;&emsp;&emsp;<span class="keyword">public </span> Class&#60;?&#62;[] getRootConfigClasses() {
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">return</span> null;
                            &emsp;&emsp;&emsp;&emsp;}

                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Override</span>
                            &emsp;&emsp;&emsp;&emsp;<span class="keyword">public </span> Class&#60;?&#62;[] getServletConfigClasses() {
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">return new</span> Class&#60;?&#62;[] { MyWebConfig.class };
                            &emsp;&emsp;&emsp;&emsp;}

                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Override</span>
                            &emsp;&emsp;&emsp;&emsp;<span class="keyword">public </span> String[] getServletMappings() {
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">return new</span> String[] { <span class="string">"/"</span> };
                            &emsp;&emsp;&emsp;&emsp;}
                        }
                </code>
            </pre>

            <p>Εάν χρησιμοποιούμε Spring Boot, χρησιμοποιώντας το starter dependency <span class="highlight">spring-boot-starter-web</span>, το Spring Boot
            παρέχει το configuration και δημιουργεί το DispatcherServlet για εμάς.</p>
        </section>

        <section class="controllers">
            <h5>Annotated Controllers</h5>

            <p>Το Spring MVC παρέχει ένα annotation-based προγραμματιστικό μοντέλο, όπου τα <span class="code">@Controller</span> και <span class="code">@RestController</span> components, 
                χρησιμοποιούν annotations, για να δηλώσουν request mappings, request input, exception handling κ.α. Οι annotated controllers έχουν
                ευέλικτες υπογραφές μεθόδων και όυτε κάνουν extend base κλάσεις, ούτε υλοποιούν συγκεκριμένες διεπαφές.
            </p>

            <p>Μπορούμε, να δηλώσουμε controller beans, χρησιμοποιώντας τον τυπικό τρόπο ορισμού των Spring beans, στο WebApplicationContext του Servlet.
                Το <span class="code">@Controller</span> stereotype καθιστά δυνατή, την εύρεση του controller bean από το μηχανισμό εύρεσης components του Spring και υποδεικνύει
                ότι είναι ένα web component. Το παρακάτω παράδειγμα δείχνει έναν controller, που ορίζεται με annotations;
            </p>

            <pre>
                <code>
                        <span class="annotation">@Controller</span>
                        <span class="keyword">public class</span> HelloController {

                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Override</span>
                            &emsp;&emsp;&emsp;&emsp;<span class="keyword">public </span> String handle (Model model) {
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;model.addAttribute(<span class="string">"message"</span>, <span class="string">"Hello World!"</span>);
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">return</span> <span class="string">"index"</span>;
                            &emsp;&emsp;&emsp;&emsp;}

                        }
                </code>
            </pre>

            <p>Η μέθοδος δέχεται ένα Model και επιστρέφει ένα όνομα view ως String.</p>

            <p>Το <span class="code">@RestController</span> είναι ένα σύνθετο annotation, το οποίο περιέχει τα annotations <span class="code">@Controller</span> και 
                <span class="code">@ResponseBody</span> και υποδεικνύει έναν controller, του οποίου όλες οι μέθοδοι κληρονομούν το type-level 
                <span class="code">@ResponseBody</span> annotation, όποτε γράφουν κατευθείαν στο response body και δεν κάνουν render ένα HTML template.</p>
        </section>

        <section class="request-mapping">
            <h5>Request Mapping</h5>

            <p>Το annotation <span class="code">@RequestMapping</span> χρησιμοποιείται για την αντιστοίχιση αιτημάτων με μεθόδους του controller. Έχει διάφορα attributes,
                ώστε να πραγματοποιείται αντιστοίχιση σύμφωνα με την HTTP μέθοδο, τα request paremeters, τα headers και media types. Μπορεί να χρησιμοποιηθεί
                σε επίπεδο κλάσης, ώστε να εκφράσει μοιραζόμενες αντιστοιχίσεις ή σε επίπεδο μεθόδου, για να αντιστοιχιστεί με ένα συγκεκριμένο endpoint.
            </p>

            <p>Υπάρχουν επίσης συντομεύσεις του <span class="code">@RequestMapping</span>, ανάλογα με την HTTP μέθοδο :</p>

            <ul>
                <li><span class="code">@GetMapping</span></li> 
                <li><span class="code">@PostMapping</span></li> 
                <li><span class="code">@PutMapping</span></li> 
                <li><span class="code">@DeleteMapping</span></li> 
                <li><span class="code">@PatchMapping</span></li> 
            </ul>

            <p>Το επόμενο παράδειγμα έχει mapping επιπέδου τύπου και μεθόδου:</p>

            <pre>
                <code>
                        <span class="annotation">@RestController</span>
                        <span class="annotation">@RequestMapping(</span><span class="string">"/persons"</span>)
                        <span class="keyword">public class</span> PersonController {

                            &emsp;&emsp;&emsp;&emsp;<span class="comments">// GET /persons/11</span>
                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@RequestMapping(</span><span class="string">"/{id}"</span>)
                            &emsp;&emsp;&emsp;&emsp;<span class="keyword">public </span> Person getPerson (<span class="annotation">@PathVariable</span> Long id) {
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// ...</span>
                            &emsp;&emsp;&emsp;&emsp;}

                            &emsp;&emsp;&emsp;&emsp;<span class="comments">// POST /persons</span>
                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@PostMapping</span>
                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@ResponseStatus</span>(HttpStatus.CREATED)
                            &emsp;&emsp;&emsp;&emsp;<span class="keyword">public </span> void add (<span class="annotation">@RequestBody </span> Person person) {
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// ...</span>
                            &emsp;&emsp;&emsp;&emsp;}

                        }
                </code>
            </pre>
        </section>

        <section class="url-variable">
            <h5>URL Variables</h5>

            <p>Μπορούμε να δηλώσουμε URL variable και πάρουμε την τιμή τους με το annotation <span class="code">@PathVariable</span>. </p>

            <pre>
                <code>

                            &emsp;&emsp;&emsp;&emsp;<span class="comments">// GET /owners/11/pets/20</span>
                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@GetMapping(</span><span class="string">"/owners/{ownerId}/pets/{petId}"</span>)
                            &emsp;&emsp;&emsp;&emsp;<span class="keyword">public </span> Pet findPet (<span class="annotation">@PathVariable</span> Long ownerId, <span class="annotation">@PathVariable</span> Long petId) {
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// ownerId = 11</span>
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// petId = 20</span>
                            &emsp;&emsp;&emsp;&emsp;}
                        }
                </code>
            </pre>
        </section>

        <section class="media-types">
            <h5>Consumable Media Types</h5>

            <p>Μπορούμε να ορίσουμε το <span class="code">Content-Type</span> του αιτήματος. </p>

            <pre>
                <code>

                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@PostMapping(</span> path = <span class="string">"/path"</span>, consumes  = <span class="string">"application/json"</span>)
                            &emsp;&emsp;&emsp;&emsp;<span class="keyword">public </span> void addPet (<span class="annotation">@RequestBody )</span> Pet pet{
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// ...</span>
                            &emsp;&emsp;&emsp;&emsp;}
                        }
                </code>
            </pre>

            <h5 class="mt-5">Producible  Media Types</h5>

            <p>Μπορούμε να ορίσουμε το περιεχόμενο της απάντησης, ανάλογα με το <span class="code">Accept</span> header του αιτήματος. </p>

            <pre>
                <code>

                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@GetMapping(</span> path = <span class="string">"/pets/{petId}"</span>, produces   = <span class="string">"application/json;charset=UTF-8"</span>)
                            &emsp;&emsp;&emsp;&emsp;<span class="annotation">@ResponseBody</span>
                            &emsp;&emsp;&emsp;&emsp;<span class="keyword">public </span> Pet getPet (<span class="annotation">@PathVariable  )</span> String petId{
                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// ...</span>
                            &emsp;&emsp;&emsp;&emsp;}
                        }
                </code>
            </pre>
        </section>
    </div>

  </body>
</html>
