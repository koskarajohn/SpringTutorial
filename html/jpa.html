<!DOCTYPE html>
<html>
  <head>
    <title>JPA</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/index.css">
    
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
  </head>

  <body>

    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary" id="sideNav">

        <a class="navbar-brand" href="../index.html">
            <span>Learn Spring</span>
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false">
                <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="spring.html">Spring</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-container.html">Spring IoC Container</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-beans.html">Spring Beans</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="dependency-injection.html">Dependency Injection</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="annotations.html">Annotations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-boot.html">Spring Boot</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-mvc.html">Spring MVC</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="rest-api.html">REST API</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="jpa.html">JPA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-data-jpa.html">Spring Data JPA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step2.html">Βημα 2</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step3.html">Βημα 3</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step4.html">Βημα 4</a>
                </li>    
                <li class="nav-item">
                    <a class="nav-link" href="step5.html">Βημα 5</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step6.html">Βημα 6</a>
                </li>  

            </ul>
        </div>
    </nav>

    <div class="container-fluid content">

        <h1 class="text-center">JPA</h1>

        <section class="intro">

            <p>Το <span class="bold">Java Persistance API (JPA)</span> είναι ένα Java <span class="bold">specification</span>, μέρος της Java EE, 
                για την <span class="bold">ανάκτηση, αποθήκευση και διαχείριση δεδομένων</span>, μεταξύ αντικειμένων της Java και της σχεσιακής βάσης δεδομένων. Θεωρείται η πιο standard προσέγγιση για 
                <span class="bold">Object to Relational Mapping (ORM)</span> στη βιομηχανία της Java.
            </p>

            <p>To JPA είναι ένα <span class="bold">σύνολο</span> από <span class="bold">διεπαφές</span>, οι οποίες απαιτούν μια υλοποίηση. Δημοφιλείς υλοποιήσεις είναι το Hibernate, EclipseLink και 
                Apache OpenJPA. Η υλοποίηση του JPA συνήθως λέγεται persistence provider.
            </p>

            <p>Επίσης, επιτρέπει στους developers, να <span class="bold">δουλεύουν απευθείας με objects (POJOs)</span>, <span class="bold">αντί με εντολές SQL</span>. Η αντιστοίχιση των κλάσεων της Java, με 
                τους πίνακες της βάσης δεδομένων πραγματοποιείται με annotations ή XML. Παρακάτω, δίνεται ένα παράδειγμα αποθήκευσης ενός entity στη βάση δεδομένων:
            </p>

        </section>

        <section class="entities">

            <h5>Entities</h5>

            <p>Ένα entity είναι ένα <span class="bold">ελαφρύ</span>, <span class="bold">persistance domain object</span>. Αντιπροσωπεύει έναν <span class="bold">πίνακα</span> στην <span class="bold">βάση δεδομένων</span> 
                και <span class="bold">κάθε στιγμιότυπο</span> του entity, <span class="bold">αντιστοιχεί σε μια γραμμή</span> εκείνου του πίνακα. 
                Μια entity κλάση πρέπει, να ικανοποιεί τις ακόλουθες απαιτήσεις:
            </p>

            <ul>
                <li>Η κλάση πρέπει, να έχει το annotation <span class="code">@Entity</span>.</li>
                <li>Η κλάση πρέπει <span class="bold">τουλάχιστον</span> έναν <span class="code">public</span> ή <span class="code">protected</span>, <span class="bold">κενό κατασκευαστή</span>. </li>
                <li>Η κλάση δεν πρέπει, να δηλωθεί ως <span class="code">final</span>. Καμία μέθοδος ή persistent μεταβλητή στιγμιότυπου δεν πρέπει, να δηλωθεί ως <span class="code">final</span>.</li>
            </ul>

            <p>Όλα τα πεδία αποθηκεύονται στη βάση δεδομένων, εκτός αν κάποιο έχει το annotation <span class="code">@Transient</span>. Παρακάτω δίνεται ένα παράδειγμα 
            ενος Entity. Αντιστοιχίζεται η κλάση Category, με τον πίνακα categories της βάσης δεδομένων.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"categories"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> Category{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Id</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(name = </span><span class="string">"name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull(</span>message = <span class="string">"Please provide category name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Size(</span>min = 3, max = 200, message = <span class="string">"Name must be between 3 and 200 characters"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private String</span> name;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Transient</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private String</span> thisWillNotBeSavedInTheDatabaseTable;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> Category() {}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        </section>

        <section class="validation">
            <h5>Bean validation</h5>

            <p>Το Java API για τα <span class="bold">JavaBeans Validation (Bean Validation)</span> παρέχει έναν μηχανισμό, για να κάνουμε <span class="bold">validate τα δεδομένα</span> της εφαρμογής.</p>

            <p>Παρέχει <span class="bold">περιορισμούς</span> Bean Validation, τα οποία <span class="bold">εφαρμοζόνται στα πεδία</span> των persistent κλάσεων.</p>

            <p>Στο προηγούμενο παράδειγμα, το annotation <span class="code">@NotNull</span> του πεδίου name, δηλώνει ότι το πεδίο αυτό είναι υποχρεωτικό. Εάν δημιουργηθεί ένα 
                στιγμιότυπο Category, στο οποίο δεν έχει αρχικοποιηθεί το πεδίο name, τότε το Bean Validation θα προκαλέσει ένα <span class="bold">validation error</span>. Αντιστοίχα,
                το annotation <span class="code">@Size</span> δηλώνει ότι το πεδίο name, πρέπει να έχει μήκος 3 εώς 200 χαρακτήρων. 
            </p>
        </section>

        <section class="primary-keys">
            <h5>Πρωτεύοντα κλειδιά στα Entities</h5>

            <p>Κάθε entity έχει <span class="bold">ένα μοναδικό αναγνωριστικό</span> αντικειμένου, δηλαδή ένα <span class="bold">πρωτεύον κλειδί</span>. 
                Αυτό μπορεί, να είναι <span class="bold">απλό</span> ή <span class="bold">σύνθετο</span>.</p>

            <p>Για να δηλώσουμε ένα <span class="bold">απλό</span> πρωτεύον κλειδί, χρησιμοποιούμε το <span class="bold">annotation</span> <span class="code">@Id</span>.</p>

            <p><span class="bold">Σύνθετο</span> πρωτεύον κλειδί χρησιμοποιούμε, όταν το <span class="bold">κλειδί αποτελείται από περισσότερα από ενα πεδία</span>. Τότε το κλειδί πρέπει, να οριστεί σε μια κλάση
                πρωτεύοντος κλειδιού. Για να δηλώσουμε, ένα σύνθετο πρωτεύον κλειδί, χρησιμοποιούμε το <span class="bold">annotation</span> <span class="code">@EmbeddedId</span>.
            </p>

            <p>Παράδειγμα απλού πρωτεύοντος κλειδιού.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"categories"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> Category{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Id</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(name = </span><span class="string">"name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull(</span>message = <span class="string">"Please provide category name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Size(</span>min = 3, max = 200, message = <span class="string">"Name must be between 3 and 200 characters"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private String</span> name;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> Category() {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>
		
	                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <p>Παράδειγμα σύνθετου πρωτεύοντος κλειδιού.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Embeddable</span> 
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> OrderProductPrimaryKey implements Serializable{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> orderId;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> productId;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> OrderProductPrimaryKey() {}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> OrderProductPrimaryKey(<span class="keyword">int</span> orderId, <span class="keyword">int</span> productId) {
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;   <span class="this">this</span>.orderId = orderId;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;   <span class="this">this</span>.productId = productId;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Override</span> 
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public boolean</span> equals(Object o) {
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">if</span> (<span class="this">this</span> == o) <span class="keyword">return true</span> ;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> OrderProductPrimaryKey))<span class="keyword"> return false</span> ;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; OrderProductPrimaryKey that = (OrderProductPrimaryKey) o;    
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">return</span>  Objects.equals(getOrderId(), that.getOrderId()) && Objects.equals(getProductId(), that.getProductId());
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Override</span> 
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public int</span> hashCode() {
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">return</span>  Objects.hash(getOrderId(), getProductId());
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span> 
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"order_products"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> OrderProduct  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@EmbeddedId</span> 
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> OrderProductPrimaryKey id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@OneToOne</span> (fetch = FetchType.LAZY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@MapsId(</span><span class="string">"orderId"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> Order order;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@OneToOne</span> (fetch = FetchType.LAZY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@MapsId(</span><span class="string">"productId"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> Product product;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull</span> (message = "Please provide quantity"))
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"quantity"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> int quantity;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> OrderProduct() {}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        </section>

        <section class="multiplicity ">

            <h5>Πολλαπλότητα στις σχέσεις των entities</h5>

            <table class="multiplicity-annotations">
                <tr>
                    <th>Πολλαπλότητα</th>
                    <th>Περιγραφή</th>
                </tr>
                <tr>
                    <td><span class="bold">1-1</span></td>
                    <td><span class="bold">Κάθε στιγμιότυπο</span> του entity, συσχετίζεται με <span class="bold">ένα μόνο στιγμιότυπο</span> ενός άλλου entity. Χρησιμοποιούμε το annotation <span class="bold">@OneToOne</span> στο αντίστιοιχο πεδίο.</td>
                </tr>
                <tr>
                    <td><span class="bold">1-Ν</span></td>
                    <td><span class="bold">Κάθε στιγμιότυπο</span> του entity, συσχετίζεται με <span class="bold">πολλά στιγμιότυπα</span> ενός άλλου entity. Χρησιμοποιούμε το annotation <span class="bold">@OneToMany</span> στο αντίστιοιχο πεδίο.</td>
                </tr>
                <tr>
                    <td><span class="bold">Ν-1</span></td>
                    <td><span class="bold">Πολλά στιγμιότυπα</span> του entity, συσχετίζονται με <span class="bold">ένα μόνο στιγμιότυπο</span> ενός άλλου entity. Χρησιμοποιούμε το annotation <span class="bold">@ManyToOne</span> στο αντίστιοιχο πεδίο.</td>
                </tr>
                <tr>
                    <td><span class="bold">Ν-Ν</span></td>
                    <td><span class="bold">Πολλά στιγμιότυπα</span> του entity, συσχετίζονται με <span class="bold">πολλά στιγμιότυπα</span> ενός άλλου entity. Χρησιμοποιούμε το annotation <span class="bold">@ManyToMany</span> στο αντίστιοιχο πεδίο.</td>
                </tr>
            </table>

            <p class="mt-5">Παρακάτω, δίνεται ένα παράδειγμα Ν-1. Στην βάση δεδομένων υπάρχουν δύο πίνακες products και categories, οι οποίοι αντιστιχίζονται με 
                τα entities Product και Category. Ο πίνακας products έχει ένα ξένο κλειδί category_id, το οποίο αναφέρεται στο πρωτεύον κλειδί του πίνακα
                 categories. Το entity Product έχει ένα πεδίο Category, το οποίο έχει annotation <span class="code">@ManyToOne</span>. Αυτό το annotation σημαίνει ότι πολλά προιόντα
                 μπορούν, να ανήκουν σε μία μόνο κατηγορία.
            </p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span> 
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"products"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> Product  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Id</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@ManyToOne</span> (optional = false)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@JoinColumn(</span>name = <span class="string">"category_id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull</span> 
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> Category category;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Rest of the fields ...</span>

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> Product() {}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        </section>

        <section class="entity-managers">
            <h5>Entity Manager</h5>

            <p>Τα entities <span class="bold">διαχειρίζονται από τον entity manager</span>, ο οποίος αντιπροσωπεύεται από την <span class="bold">διεπαφή</span> <span class="code">javax.persistence.EntityManager</span>.
                Κάθε στιγμιότυπο EntityManager είναι συσχετισμένο με ένα persistence context. <span class="bold">Persistence context</span> είναι<span class="bold">ένα σύνολο από 
                    διαχειριζόμενα στιγμιότυπα από entities</span> , τα οποία υπάρχουν σε μια συγκεκριμένη <span class="bold">αποθήκη δεδομένων</span>. Ορίζει την εμβέλεια, μέσα στην οποία δημιουργούνται,
                ανακτούνται και διαγράφονται τα στιγμιότυπα των entities. Η διεπαφή EntityManager παρέχει <span class="bold">μεθόδους για την αλληλεπίδραση</span> με το Persistence Context.
            </p>

            <p class="font-weight-bold">Container-Managed Entity Managers</p>

            <p >Στην περίπτωση του Container-Managed Entity Manager, ο EntityManager δημιουργείται και διαχειρίζεται από το container. Για να πάρουμε ένα
                στιγμιότυπο του EntityManager, τον κάνουμε inject.
            </p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@PersistenceContext</span> 
                    &emsp;&emsp;&emsp;&emsp;EntityManager em;
                </code>
            </pre>

            <p class="font-weight-bold">Application-Managed Entity Managers</p>

            <p>Στην περίπτωση του Application-Managed Entity Manager, πρέπει εμείς, να δημιουργήσουμε και να διαχειρίστουμε τον EntityManager. Για να πάρουμε ένα
                στιγμιότυπο του EntityManager, πρέπει πρώτα να κάνουμε inject ένα EntityManagerFactory.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@PersistenceUnit</span> 
                    &emsp;&emsp;&emsp;&emsp;EntityManagerFactory emf;
                    &emsp;&emsp;&emsp;&emsp;EntityManager em = emf.createEntityManager();
                </code>
            </pre>
        </section>

        <section class="jpql">

            <h5>JPQL</h5>

            <p>Η Java Persistence query language ορίζεται στο JPA specification και μας επιτρέπει να ορίσουμε ερωτήματα πάνω σε entities, τα οποία είναι αποθηκευμένα στη
                βάση δεδομένων.
            </p>

            <h5>Σύνταξη</h5>

            <p>Η σύνταξη της γλώσσας είναι παρόμοια με αυτή της SQL. Η SQL δουλεύει άμεσα με τη βάση δεδομένων και τις εγγραφές, ενώ η JPQL 
                δουλεύει με τις κλάσεις Entities και τα στιγμιότυπα τους. Παρακάτω δίνεται η σύνταξη ενός SELECT ερωτήματος, για να ανακτήσουμε ένα entity.
            </p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> ...
                    &emsp;&emsp;&emsp;&emsp;[<span class="keyword">WHERE</span> ...]
                    &emsp;&emsp;&emsp;&emsp;[<span class="keyword">GROUP BY</span> ... [<span class="keyword">HAVING </span> ...]]
                    &emsp;&emsp;&emsp;&emsp;[<span class="keyword">ORDER BY</span> ...]
                </code>
            </pre>

            <p>Η σύνταξη των ερωτημάτων DELETE και UPDATE ερωτήματος δίνεται παρακάτω.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">DELETE FROM</span> ... [<span class="keyword">WHERE  </span> ...]
                    
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">UPDATE</span> ... <span class="keyword">SET</span> ... [<span class="keyword">WHERE  </span> ...]
                </code>
            </pre>

            <p>Μπορούμε, να πραγματοποιήσουμε ερωτήματα χρησιμοποιώντας τη μέθοδο EntityManager.createQuery του EntityManager και την Query.executeUpdate.
                Παρακάτω δίνονται παραδείγματα SELECT, UPDATE και DELETE ερωτημάτων για την κλάση Entity Category. 
            </p>

            <pre>
                <code>

                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public Category</span>  findCategoryWithName(String name)  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">return</span> em.createQuery(
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="string">"SELECT c FROM Category c WHERE c.name = :name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;.setParameter(<span class="string">"name"</span>, <span class="string">"Vitamins"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;.getResultList();
                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <pre>
                <code>

                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public void</span>  updateCategory(String name)  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Query query = em.createQuery(<span class="string">"UPDATE Category c SET c.name = :newName WHERE c.name = :oldName"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;query.setParameter(<span class="string">"newName"</span>, <span class="string">"Basket"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;query.setParameter(<span class="string">"oldName"</span>, <span class="string">"Football"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;int rowsUpdated = query.executeUpdate();
                    &emsp;&emsp;&emsp;&emsp;} 
                    
                </code>
            </pre>

            <pre>
                <code>

                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public void</span>  deleteCategory(String name)  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Query query = em.createQuery(<span class="string">"DELETE FROM Category c WHERE c.name = :name"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;query.setParameter(<span class="string">"name"</span>, <span class="string">"Basket"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;int rowsDeleted = query.executeUpdate();
                    &emsp;&emsp;&emsp;&emsp;} 
                    
                </code>
            </pre>
        </section>

        <section class="references">

            <h5>Πηγές</h5>

            <ul>
                <li><a href="https://javaee.github.io/tutorial/persistence-intro002.html">Java EE 8 - Entities</a></li>
                <li><a href="https://javaee.github.io/tutorial/persistence-intro004.html#BNBQY">Java EE 8 - Managing Entities</a></li>
                <li><a href="https://en.wikibooks.org/wiki/Java_Persistence/What_is_JPA%3F">Wikibooks : Java Persistence/What is JPA?</a></li>
                <li><a href="http://www.vogella.com/tutorials/JavaPersistenceAPI/article.html">Voggela : Java persistence API - Tutorial</a></li>
                <li><a href="https://www.tutorialspoint.com/jpa/jpa_jpql.htm">tutorialspoint : JPA - JPQL</a></li>
                <li><a href="https://javaee.github.io/tutorial/persistence-querylanguage.html">Java EE 8 - 42 The Java Persistence Query Language</a></li>
            </ul>
        </section>
        
    </div>

  </body>
</html>
