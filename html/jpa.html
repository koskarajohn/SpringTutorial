<!DOCTYPE html>
<html>
  <head>
    <title>JPA</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/index.css">
    
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
  </head>

  <body>

    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary" id="sideNav">

        <a class="navbar-brand" href="../index.html">
            <span>Learn Spring</span>
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false">
                <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="spring.html">Spring</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-container.html">Spring IoC Container</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-beans.html">Spring Beans</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="dependency-injection.html">Dependency Injection</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="annotations.html">Annotations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-boot.html">Spring Boot</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-mvc.html">Spring MVC</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="rest-api.html">REST API</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="jpa.html">JPA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step2.html">Βημα 2</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step3.html">Βημα 3</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step4.html">Βημα 4</a>
                </li>    
                <li class="nav-item">
                    <a class="nav-link" href="step5.html">Βημα 5</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step6.html">Βημα 6</a>
                </li>  

            </ul>
        </div>
    </nav>

    <div class="container-fluid content">

        <h1 class="text-center">JPA</h1>

        <section class="intro">

            <p>Το Java Persistance API (JPA) είναι ένα Java specification, μέρος της Java EE, για την ανάκτηση, αποθήκευση και διαχείριση δεδομένων, μεταξύ
                αντικειμένων της Java και της σχεσιακής βάσης δεδομένων. Θεωρείται η πιο standard προσέγγιση για Object to Relational Mapping (ORM)
                στη βιομηχανία της Java.
            </p>

            <p>To JPA είναι ένα σύνολο από διεπαφές, οι οποίες απαιτούν μια υλοποίηση. Δημοφιλείς υλοποιήσεις είναι το Hibernate, EclipseLink και 
                Apache OpenJPA. Η υλοποίηση του JPA συνήθως λέγεται persistence provider.
            </p>

            <p>Επίσης, επιτρέπει στους developers, να δουλεύουν απευθείας με objects (POJOs), αντί με εντολές SQL. Η αντιστοίχιση των κλάσεων της Java, με 
                τους πίνακες της βάσης δεδομένων πραγματοποιείται με annotations ή XML.
            </p>

        </section>

        <section class="entities">

            <h5>Entities</h5>

            <p>Ένα entity είναι ένα ελαφρύ, persistance domain object. Αντιπροσωπεύει έναν πίνακα στην βάση δεδομένων και κάθε στιγμιότυπο του entity,
                αντιστοιχεί σε μια γραμμή εκείνου του πίνακα. Μια entity κλάση πρέπει, να ικανοποιεί τις ακόλουθες απαιτήσεις:
            </p>

            <ul>
                <li>Η κλάση πρέπει, να έχει το annotation <span class="code">@Entity</span>.</li>
                <li>Η κλάση πρέπει τουλάχιστον έναν <span class="code">public</span> ή <span class="code">protected</span>, κενό κατασκευαστή. </li>
                <li>Η κλάση δεν πρέπει, να δηλωθεί ως final. Καμία μέθοδος ή persistent μεταβλητή στιγμιότυπου δεν πρέπει, να δηλωθεί ως final.</li>
            </ul>

            <p>Όλα τα πεδία αποθηκεύονται στη βάση δεδομένων, εκτός αν κάποιο έχει το annotation <span class="code">@Transient</span>. Παρακάτω δίνεται ένα παράδειγμα 
            ενος Entity. Αντιστοιχίζεται η κλάση Category, με τον πίνακα categories της βάσης δεδομένων.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"categories"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> Category{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Id</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(name = </span><span class="string">"name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull(</span>message = <span class="string">"Please provide category name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Size(</span>min = 3, max = 200, message = <span class="string">"Name must be between 3 and 200 characters"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private String</span> name;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Transient</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private String</span> thisWillNotBeSavedInTheDatabaseTable;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> Category() {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>
		
	                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        </section>

        <section class="validation">
            <h5>Bean validation</h5>

            <p>Το Java API για τα JavaBeans Validation (Bean Validation) παρέχει έναν μηχανισμό, για να κάνουμε validate τα δεδομένα της εφαρμογής.</p>

            <p>Παρέχει περιορισμούς Bean Validation, τα οποία εφαρμοζόνται στα πεδία των persistent κλάσεων.</p>

            <p>Στο προηγούμενο παράδειγμα, το annotation @NotNull του πεδίου name, δηλώνει ότι το πεδίο αυτό είναι υποχρεωτικό. Εάν δημιουργηθεί ένα 
                στιγμιότυπο Category, στο οποίο δεν έχει αρχικοποιηθεί το πεδίο name, τότε το Bean Validation θα προκαλέσει ένα validation error. Αντιστοίχα,
                το annotation @Size δηλώνει ότι το πεδίο name, πρέπει να έχει μήκος 3 εώς 200 χαρακτήρων. 
            </p>
        </section>

        <section class="primary-keys">
            <h5>Πρωτεύοντα κλειδιά στα Entities</h5>

            <p>Κάθε entity έχει ένα μοναδικό αναγνωριστικό αντικειμένου, δηλαδή ένα πρωτεύον κλειδί. Αυτό μπορεί, να είναι απλό ή σύνθετο.</p>

            <p>Για να δηλώσουμε ένα απλό πρωτεύον κλειδί, χρησιμοποιούμε το annotation @Id.</p>

            <p>Σύνθετο πρωτεύον κλειδί χρησιμοποιούμε, όταν το κλειδί αποτελείται από περισσότερα από ενα πεδία. Τότε το κλειδί πρέπει, να οριστεί σε μια κλάση
                πρωτεύοντος κλειδιού. Για να δηλώσουμε, ένα σύνθετο πρωτεύον κλειδί, χρησιμοποιούμε το annotation @EmbeddedId.
            </p>

            <p>Παράδειγμα απλού πρωτεύοντος κλειδιού.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"categories"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> Category{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Id</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(name = </span><span class="string">"name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull(</span>message = <span class="string">"Please provide category name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Size(</span>min = 3, max = 200, message = <span class="string">"Name must be between 3 and 200 characters"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private String</span> name;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> Category() {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>
		
	                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <p>Παράδειγμα σύνθετου πρωτεύοντος κλειδιού.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Embeddable</span> 
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> OrderProductPrimaryKey implements Serializable{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> orderId;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> productId;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> OrderProductPrimaryKey() {}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> OrderProductPrimaryKey(<span class="keyword">int</span> orderId, <span class="keyword">int</span> productId) {
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;   <span class="this">this</span>.orderId = orderId;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;   <span class="this">this</span>.productId = productId;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Override</span> 
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public boolean</span> equals(Object o) {
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">if</span> (<span class="this">this</span> == o) <span class="keyword">return true</span> ;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> OrderProductPrimaryKey))<span class="keyword"> return false</span> ;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; OrderProductPrimaryKey that = (OrderProductPrimaryKey) o;    
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">return</span>  Objects.equals(getOrderId(), that.getOrderId()) && Objects.equals(getProductId(), that.getProductId());
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Override</span> 
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public int</span> hashCode() {
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">return</span>  Objects.hash(getOrderId(), getProductId());
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span> 
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"order_products"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> OrderProduct  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@EmbeddedId</span> 
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> OrderProductPrimaryKey id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@OneToOne</span> (fetch = FetchType.LAZY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@MapsId(</span><span class="string">"orderId"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> Order order;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@OneToOne</span> (fetch = FetchType.LAZY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@MapsId(</span><span class="string">"productId"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> Product product;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull</span> (message = "Please provide quantity"))
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"quantity"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> int quantity;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> OrderProduct() {}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        </section>

        <section class="multiplicity ">

            <h5>Πολλαπλότητα στις σχέσεις των entities</h5>

            <table class="multiplicity-annotations">
                <tr>
                    <th>Πολλαπλότητα</th>
                    <th>Περιγραφή</th>
                </tr>
                <tr>
                    <td><span class="bold">1-1</span></td>
                    <td>Κάθε στιγμιότυπο του entity, συσχετίζεται με ένα μόνο στιγμιότυπο ενός άλλου entity. Χρησιμοποιούμε το annotation <span class="bold">@OneToOne</span> στο αντίστιοιχο πεδίο.</td>
                </tr>
                <tr>
                    <td><span class="bold">1-Ν</span></td>
                    <td>Κάθε στιγμιότυπο του entity, συσχετίζεται με πολλά στιγμιότυπα ενός άλλου entity. Χρησιμοποιούμε το annotation <span class="bold">@OneToMany</span> στο αντίστιοιχο πεδίο.</td>
                </tr>
                <tr>
                    <td><span class="bold">Ν-1</span></td>
                    <td>Πολλά στιγμιότυπα του entity, συσχετίζονται με ένα μόνο στιγμιότυπο ενός άλλου entity. Χρησιμοποιούμε το annotation <span class="bold">@ManyToOne</span> στο αντίστιοιχο πεδίο.</td>
                </tr>
                <tr>
                    <td><span class="bold">Ν-Ν</span></td>
                    <td>Πολλά στιγμιότυπα του entity, συσχετίζονται με πολλά στιγμιότυπα ενός άλλου entity. Χρησιμοποιούμε το annotation <span class="bold">@ManyToMany</span> στο αντίστιοιχο πεδίο.</td>
                </tr>
            </table>

            <p class="mt-5">Παρακάτω, δίνεται ένα παράδειγμα Ν-1. Στην βάση δεδομένων υπάρχουν δύο πίνακες products και categories, οι οποίοι αντιστιχίζονται με 
                τα entities Product και Category. Ο πίνακας products έχει ένα ξένο κλειδί category_id, το οποίο αναφέρεται στο πρωτεύον κλειδί του πίνακα
                 categories. Το entity Product έχει ένα πεδίο Category, το οποίο έχει annotation @ManyToOne. Αυτό το annotation σημαίνει ότι πολλά προιόντα
                 μπορούν, να ανήκουν σε μία μόνο κατηγορία.
            </p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span> 
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"products"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> Product  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Id</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@ManyToOne</span> (optional = false)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@JoinColumn(</span>name = <span class="string">"category_id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull</span> 
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> Category category;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Rest of the fields ...</span>

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> Product() {}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        </section>

        <section class="references">

            <h5>Πηγές</h5>

            <ul>
                <li><a href="https://javaee.github.io/tutorial/toc.html">Java EE 8 - Tutorial</a></li>
                <li><a href="https://en.wikibooks.org/wiki/Java_Persistence/What_is_JPA%3F">Wikibooks : Java Persistence/What is JPA?</a></li>
                <li><a href="http://www.vogella.com/tutorials/JavaPersistenceAPI/article.html">Voggela : Java persistence API - Tutorial</a></li>
            </ul>
        </section>
        
    </div>

  </body>
</html>
