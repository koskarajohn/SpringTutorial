<!DOCTYPE html>
<html>
  <head>
    <title>Spring Data JPA</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/index.css">
    
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
  </head>

  <body>

     <nav class="navbar navbar-expand-md fixed-top" id="mainNav">

        <div class="container">
            <a class="navbar-brand" href="index.html">SpringTutorial</a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false">
                <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-5">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarSpring" data-toggle="dropdown">Spring</a>
                    <ul class="dropdown-menu">
                        <li> <a class="dropdown-item" href="spring.html">What is Spring</a> </li>  
                        <li><a class="dropdown-item" href="spring-container.html">Spring IoC Container</a>  </li>  
                        <li>  <a class="dropdown-item" href="spring-beans.html">Spring Beans</a> </li> 
                        <li> <a class="dropdown-item" href="dependency-injection.html">Dependency Injection</a>  </li> 
                        <li> <a class="dropdown-item" href="annotations.html">Annotations</a> </li>  
                        <li> <a class="dropdown-item" href="spring-boot.html">Spring Boot</a> </li>  
                        <li> <a class="dropdown-item" href="spring-mvc.html">Spring Mvc</a> </li>  
                        <li>  <a class="dropdown-item" href="spring-security.html">Spring Security</a> </li> 
                        <li> <a class="dropdown-item" href="rest-api.html">Rest API</a>  </li> 
                        <li><a class="dropdown-item" href="application-properties.html">Application Properties</a>  </li>  
                    </ul>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarJpa" data-toggle="dropdown">JPA</a>
                  <ul class="dropdown-menu">
                       <li> <a class="dropdown-item" href="jpa.html">JPA</a> </li>       
                       <li>  <a class="dropdown-item" href="spring-data-jpa.html">Spring Data Jpa</a> </li>      
                  </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarSetup" data-toggle="dropdown">Setup εφαρμογης</a>
                    <ul class="dropdown-menu">
                      <li> <a class="dropdown-item" href="app-architecture.html">Αρχιτεκτονική εφαρμογής</a> </li>        
                      <li>  <a class="dropdown-item" href="spring-tool-suite.html">Spring Tool Suite</a> </li>       
                      <li> <a class="dropdown-item" href="heroku.html">Heroku</a>  </li>       
                      <li>  <a class="dropdown-item" href="postgresql.html">Postgres</a> </li>       
                      <li> <a class="dropdown-item" href="amazon-s3.html">Amazon S3</a> </li>        
                      <li>  <a class="dropdown-item" href="angular.html">Angular</a> </li>      
                      <li> <a class="dropdown-item" href="create-frontend.html">Δημιουργία Frontend</a>   </li>      
                      <li>  <a class="dropdown-item" href="visual-studio-code.html">Visual Studio Code</a> </li>      
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarCreateApp" data-toggle="dropdown">Κώδικας εφαρμογης</a>
                    <ul class="dropdown-menu">
                        <li class="nav-item dropleft submenu">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarSpring" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Spring</a>
                            <ul class="dropdown-menu">
                                <li> <a class="dropdown-item" href="jpa-configuration.html">Ρύθμιση βάσης δεδομένων και JPA</a> </li>  
                                <li>  <a class="dropdown-item" href="amazons3-configuration.html">Ρύθμιση Amazon S3</a> </li>     
                                <li>  <a class="dropdown-item" href="upload-images.html">Ανέβασμα εικόνων στο Amazon S3</a> </li>   
                                <li>  <a class="dropdown-item" href="create-tables-for-products.html">Δημιουργία πινάκων products, categories, brands, product_images, inventory</a> </li>    
                               <li> <a class="dropdown-item" href="create-components-products.html">Δημιουργία repositories, services για τους πίνακες brands, categories...</a> </li>      
                               <li> <a class="dropdown-item" href="insert-products.html">Δημιουργία controller,repository, service για την εισαγωγή προϊόντων</a> </li>     
                                <li>  <a class="dropdown-item" href="create-tables-deals.html">Δημιουργία πινάκων deals, deal_images</a> </li>    
                               <li> <a class="dropdown-item" href="create-components-deals.html">Δημιουργία controller,repository, service για την ανάκτηση προσφορών</a> </li>  
                            </ul>
                        </li>
                       
                        <li class="nav-item dropleft submenu">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarAngular" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Spring - Angular</a>
                            <ul class="dropdown-menu">
                               <li> <a class="dropdown-item" href="angular-routes.html">Angular - Routes</a> </li>     
                               <li>  <a class="dropdown-item" href="create-common-components.html">Angular - Components my-footer, shop-services, navigation-bar και product</a> </li>     
                               <li>  <a class="dropdown-item" href="create-index-page.html">Angular - index-page</a> </li>    
                               <li> <a class="dropdown-item" href="create-component-product-page.html">Angular - product-page</a> </li>      
                               <li>  <a class="dropdown-item" href="create-component-category.html">Angular - category-page</a> </li>    
                               <li>  <a class="dropdown-item" href="create-component-sidebar.html">Angular - category-sidebar</a> </li>     
                              <li>    <a class="dropdown-item" href="refresh-category-products.html">Angular - ανανέωση προϊόντων κατηγορίας</a></li>   
                              <li>  <a class="dropdown-item" href="spring-security-and-session.html">Spring Security - Spring Session</a> </li>    
                              <li><a class="dropdown-item" href="create-component-register.html">Angular - register-page component</a>  </li>     
                              <li> <a class="dropdown-item" href="create-component-login.html">Angular - login-page, navigation-bar components (είσοδος και αποσύνδεση)</a>  </li>
                              <li> <a class="dropdown-item" href="create-components-cart.html">Angular - cart-page component</a>  </li>
                              <li> <a class="dropdown-item" href="create-component-checkout.html">Angular - checkout-page component</a>  </li>
                              <li> <a class="dropdown-item" href="create-component-order.html">Angular - order-page component</a>  </li>
                              <li> <a class="dropdown-item" href="spring-email.html">Spring Email - αποστολή E-mail</a>  </li>
                            </ul>
                        </li>  
                    </ul>
                </li>

            </ul>
        </div>
      </div>
   
    </nav>

    <div class="container">

        <h1 class="text-center">Spring Data JPA</h1>

        <section class="intro">

            <p>Στις περισσότερες enterprise εφαρμογές, η <span class="bold">ανάκτηση πληροφοριών</span> από την <span class="bold">βάση δεδομένων</span> είναι συχνή απαίτηση. H Java
                παρέχει το <span class="bold">JDBC API</span>, το οποίο μας επιτρέπει, να εκτελούμε SQL εντολές στη βάση δεδομένων. Όμως όταν χρησιμοποιούμε το JDBC,
                πρέπει εμείς, να διαχειριστούμε τους πόρους της βάσης δεδομένων και τα Exceptions, που προκύπτουν κατά την εκτέλεση του κώδικα. Επίσης,
                ο κώδικας είναι αρκετά φλύαρος. Παρακάτω δίνεται ο κώδικας, που εκτελεί ένα SELECT στη βάση δεδομένων:
            </p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> JDBCExample  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Όνομα JDBC driver και το url της βάσης δεδομένων</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">static final</span>  String JDBC_DRIVER = <span class="string">"com.mysql.jdbc.Driver"</span>;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">static final</span>  String DB_URL = <span class="string">"jdbc:mysql://localhost/database"</span>;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Όνομα χρήστη και κωδικός</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">static final</span>  String USER = <span class="string">"username"</span>;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">static final</span>  String PASS = <span class="string">"password"</span>;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public static void</span> main(String[] args) {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Connection conn = null;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Statement stmt = null;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">try</span>{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;conn = DriverManager.getConnection(DB_URL, USER, PASS);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;stmt = conn.createStatement();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;String sql = <span class="string">"SELECT id, name FROM Categories"</span>;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;ResultSet rs = stmt.executeQuery(sql);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">while</span>(rs.next()){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;int id  = rs.getInt(<span class="string">"id"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;String name = rs.getString(<span class="string">"name"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Μετά κάνουμε ότι θέλουμε με τα αποτελέσματα</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;rs.close();

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}<span class="keyword">catch</span>(SQLException se){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;se.printStackTrace();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}<span class="keyword">catch</span>(Exception  e){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;e.printStackTrace();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}<span class="keyword">finally</span>{
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">try</span>{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">if</span>(stmt != <span class="keyword">null</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; stmt.close();

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">if</span>(conn != <span class="keyword">null</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; conn.close();

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}<span class="keyword">catch</span>(SQLException se){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;se.printStackTrace();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}
                    
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        </section>

        <section class="jpa">

            <h5>JPA</h5>

            <p>Εναλλακτικά, μπορούμε να χρησιμοποιήσουμε το JPA. Το <span class="bold">Java Persistance API (JPA)</span> είναι ένα Java <span class="bold">specification</span>, μέρος της Java EE, 
                για την <span class="bold">ανάκτηση, αποθήκευση και διαχείριση δεδομένων</span>, μεταξύ αντικειμένων της Java και της σχεσιακής βάσης δεδομένων. Θεωρείται η πιο standard προσέγγιση για 
                <span class="bold">Object to Relational Mapping (ORM)</span> στη βιομηχανία της Java.</p>

            <p>To JPA είναι ένα <span class="bold">σύνολο</span> από <span class="bold">διεπαφές</span>, οι οποίες απαιτούν μια υλοποίηση. Δημοφιλείς υλοποιήσεις είναι το Hibernate, EclipseLink και 
                Apache OpenJPA. Η υλοποίηση του JPA συνήθως λέγεται persistence provider.
            </p>

            <p>Επίσης, επιτρέπει στους developers, να <span class="bold">δουλεύουν απευθείας με objects (POJOs)</span>, <span class="bold">αντί με εντολές SQL</span>. Η αντιστοίχιση των κλάσεων της Java, με 
                τους πίνακες της βάσης δεδομένων πραγματοποιείται με annotations ή XML. Παρακάτω, δίνεται ένα παράδειγμα αποθήκευσης ενός entity στη βάση δεδομένων:
            </p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"categories"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> Category{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Id</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(name = </span><span class="string">"name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull(</span>message = <span class="string">"Please provide category name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Size(</span>min = 3, max = 200, message = <span class="string">"Name must be between 3 and 200 characters"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private String</span> name;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> Category() {}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Repository</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> CategoryRepositoryImpl <span class="keyword">implements</span> CateroryRepository{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@PersistenceContext</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private </span> EntityManager entityManager;
                    
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public void</span> create(Category category) {
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;entityManager.persist(category);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <p>Η μέθοδος create του repository είναι πολύ μικρότερη και δεν κάνουμε έλεγχο για exceptions. Παρ' όλα αυτά, πρέπει να γράψουμε μια μέθοδο 
                για κάθε CRUD λειτουργεία, που θέλουμε, να πραγματοποιήσουμε στη βάση.
            </p>
        
        </section>

        <section class="repositories">

            <h5>Data Access Object - Repositories</h5>

            <p>Ο σκοπός του <span class="bold">Data Access Object(DAO) pattern</span> είναι ο <span class="bold">διαχωρισμός του data access logic</span>, <span class="bold">από το business logic και το presentation
                logic</span>. Αυτό το pattern προτείνει, το data access logic να <span class="bold">ενθυλακώνεται σε ανεξάρτητα modules</span>, που λέγονται <span class="bold">data access objects</span>.
            </p>

            <p>Το Spring υποστηρίζει το Data Access Object, καθιστώντας εύκολο, να δουλεύουμε με διαφορετικές τεχνολογίες data access(JDBC, 
                Hibernate ή JPA) με έναν συνεπή τρόπο. <span class="bold">Mεταφράζει συγκεριμένα τεχνολογικά exceptions</span>, όπως SQLException, στην δικιά του ιεραρχία
                exception κλάσεων, τα οποία έχουν  το DataAccessException ως exception ρίζα. Αυτά τα exceptions περικλείουν το αρχικό exception.
            </p>

            <p>Για να δηλώσουμε ότι μια κλάση είναι DAO ή repository και αυτή να παρέχει μετάφραση των exceptions, χρησιμοποιούμε το annotation <span class="code">@Repository</span>.
            </p>

            <p>Παράδειγμα Repository</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Repository</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> JpaMovieFinder <span class="keyword">implements</span> MovieFinder{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@PersistenceContext</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> EntityManager entityManager;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// ...</span>

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        </section>

        <section class="spring-data-jpa">

            <h5>Spring Data Jpa</h5>

            <p>Το Spring Data JPA δεν είναι ένας JPA provider, αλλά ένα <span class="bold">specification</span>. Είναι ένα framework, το οποίο παρέχει <span class="bold">ένα επιπλέον
                επίπεδο αφαίρεσης</span> πάνω από τον JPA provider. Ο στόχος της αφαίρεσης Spring Data repository είναι, να <span class="bold">μειώσει σημαντικά
                    τον boilerplate κώδικα</span>, που απαιτείται για να δημιουργήσουμε το <span class="bold">επίπεδο data access</span>.
            </p>

            <p>Το βασικό repository, που παρέχει το Spring Data είναι το <span class="code">CrudRepository</span>. Αυτό παρέχει τις βασικές λειτουργίες <span class="bold">CRUD(Create, Read, Update, Delete)</span>.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public interface</span> CrudRepository&#60;T, ID <span class="keyword">extends</span> Serializable&#62; <span class="keyword">extends</span> Repository&#60;T, ID&#62;  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// Αποθηκεύει το συγκεκριμένο entity.</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&#60;S <span class="keyword">extends</span> T&#62; S save(S entity); 

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// Επιστρέφει το entity, με αυτό το ID.</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">Optional</span>&#60;T&#62; findById(ID primaryKey);

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// Επιστρέφει όλα τα entities.</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">Iterable</span>&#60;T&#62; findAll(); 

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// Επιστρέφει τον αριθμό των entities.</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">long</span> count(); 

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// Διαγράφει το συγκεκριμένο entity.</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">void</span> delete(T entity);

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">// Επιστρέφει αν το entity, με το ID αυτό υπάρχει.</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">boolean</span> existsById(ID primaryKey);

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <p>Το Spring Data JPA παρέχει τις υλοποιήσεις των μεθόδων για εμάς.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Repository</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public interface</span> ProductRepository  extends CrudRepository&#60;Product, Integer&#62;  {

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <p>Εάν θέλουμε να βρούμε ένα προιόν, ο κώδικας δίνεται παρακάτω:</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Autowired</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">private</span> ProductRepository  productRepository;

                    &emsp;&emsp;&emsp;&emsp;Product product = productRepository.findById(4);
                </code>
            </pre>

            <p>Για να αποθηκεύσουμε ένα προιόν, ο κώδικας δίνεται παρακάτω:</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;Product product = <span class="keyword">new</span> Product();
                    &emsp;&emsp;&emsp;&emsp;product.setName(<span class="string">"name"</span>);
                    &emsp;&emsp;&emsp;&emsp;product.setPrice(25);
                    &emsp;&emsp;&emsp;&emsp;productRepository.save(product);
                </code>
            </pre>
        </section>

        <section class="jpa-repositories">

            <h5>JPA Repositories</h5>

            <p>Τα Spring Data JPA repositories είναι default Spring beans. Είναι <span class="bold">singletons</span> και αρχικοποιούνται γρήγορα. Κάνουν extend τα
                <span class="code">CrudRepository&#60;T, ID&#62;</span> και <span class="code">PagingAndSortingRepository&#60;T, ID&#62;</span>, οπότε κληρονομούν την λειτουργικότητα τους. </p>

            <p>Για να μπορέσουμε, να χρησιμοποιήσουμε JPA Repositories, χρειάζεται XML ή Java Configuration. Παρακάτω, δίνεται το Java configuration.</p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Configuration</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@EnableJpaRepositories</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@EnableTransactionManagement</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> ApplicationConfig {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Bean</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> DataSource dataSource(){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;EmbeddedDatabaseBuilder builder = <span class="keyword">new </span>EmbeddedDatabaseBuilder();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">return</span> builder.setType(EmbeddedDatabaseType.HSQL).build();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Bean</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> DataSource dataSource(){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;HibernateJpaVendorAdapter vendorAdapter = <span class="keyword">new </span>HibernateJpaVendorAdapter();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;vendorAdapter.setGenerateDdl(true);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;LocalContainerEntityManagerFactoryBean factory  = <span class="keyword">new </span>LocalContainerEntityManagerFactoryBean();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;factory.setJpaVendorAdapter(vendorAdapter);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;factory.setPackagesToScan(<span class="string">"com.acme.repositories"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;factory.setDataSource(dataSource());
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">return</span> factory;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Bean</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> PlatformTransactionManager transactionManager(EntityManagerFactory entityManagerFactory){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;JpaTransactionManager txManager = <span class="keyword">new </span>JpaTransactionManager();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;txManager.setEntityManagerFactory(entityManagerFactory);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">return</span> txManager;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <p>Το παραπάνω configuration ρυθμίζει μια embedded <span class="bold">HSQL βάση δεδομένων</span>, χρησιμοποιώντας το EmbeddedDatabaseBuilder API του spring-jdbc. 
                Το Spring Data δημιουργεί ένα <span class="bold">EntityManagerFactory</span> και χρησιμοποιεί το <span class="bold"></span>Hibernate ως <span class="bold">persistence provider</span>. Το 3ο bean που δημιουργείται, 
                είναι το <span class="bold">JpaTransactionManager</span>. Τέλος, τα Spring Data JPA repositories ενεργοποιούνται, χρησιμοποιώντας το annotation <span class="code">@EnableJpaRepositories</span>.
            </p>

        </section>

        <section class="queries">

            <h5>Δημιουργία ερωτημάτων</h5>

            <p>Μπορούμε, να ορίσουμε ένα ερώτημα ως String ή μέσω του ονόματος της μεθόδου.</p>

            <p class="font-weight-bold">Δημιουργία ερωτημάτων μέσω του ονόματος της μεθόδου</p>

            <pre>
                <code>  
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public interface </span> UserRepository <span class="keyword">extends</span> JpaRepository&#60;User, Long&#62;{

                        &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;List&#60;User&#62; findByEmailAddressAndLastname(String emailAddress, String lastname)
                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <p>Δημιουργούμε ένα ερώτημα, χρησιμοποιώντας το JPA criteria API και αύτο μεταφράζεται στο εξής ερώτημα : <span class="code">select u from User 
                where u.emailAddress = ?1 and u.lastname = ?2</span>. Το JPA ελέγχει και διασχίζει τα properties.</p>

            <table class="jpa-keywords">
                <tr>
                    <th>Keyword</th>
                    <th>Sample</th>
                    <th>JPQL snippet</th>
                </tr>
                <tr>
                    <td>And</span></td>
                    <td>findByLastnameAndFirstname</td>
                    <td>… where x.lastname = ?1 and x.firstname = ?2</td>
                </tr>
                <tr>
                    <td>Or</td>
                    <td>findByLastnameOrFirstname</td>
                    <td>… where x.lastname = ?1 or x.firstname = ?2</td>
                </tr>
                <tr>
                    <td>Is,Equals</td>
                    <td>findByFirstname,findByFirstnameIs,findByFirstnameEquals</td>
                    <td>… where x.firstname = ?1</td>
                </tr>
                <tr>
                    <td>Between</td>
                    <td>findByStartDateBetween</td>
                    <td>… where x.startDate between ?1 and ?2</td>
                </tr>
                <tr>
                    <td>LessThan</td>
                    <td>findByAgeLessThan</td>
                    <td>… where x.age &#60; ?1</td>
                </tr>
                <tr>
                    <td>LessThanEqual</td>
                    <td>findByAgeLessThanEqual</td>
                    <td>… where x.age &#60;= ?1</td>
                </tr>
                <tr>
                    <td>GreaterThan</td>
                    <td>findByAgeGreaterThan</td>
                    <td>… where x.age &#62; ?1</td>
                </tr>
                <tr>
                    <td>GreaterThanEqual</td>
                    <td>findByAgeGreaterThanEqual</td>
                    <td>… where x.age &#62;= ?1</td>
                </tr>
                <tr>
                    <td>IsNull</td>
                    <td>findByAgeIsNull</td>
                    <td>… where x.age is null</td>
                </tr>
                <tr>
                    <td>IsNotNull,NotNull</td>
                    <td>findByAge(Is)NotNull</td>
                    <td>… where x.age not null</td>
                </tr>
                <tr>
                    <td>Like</td>
                    <td>findByFirstnameLike</td>
                    <td>… where x.firstname like ?1</td>
                </tr>
                <tr>
                    <td>OrderBy</td>
                    <td>findByAgeOrderByLastnameDesc</td>
                    <td>… where x.age = ?1 order by x.lastname desc</td>
                </tr>
                <tr>
                    <td>In</td>
                    <td>findByAgeIn(Collection&#60;Age&#62; ages)</td>
                    <td>… where x.age in ?1</td>
                </tr>
                <tr>
                    <td>True</td>
                    <td>findByActiveTrue()</td>
                    <td>… where x.active = true</td>
                </tr>
                <tr>
                    <td>False</td>
                    <td>findByActiveFalse()</td>
                    <td>… where x.active = false</td>
                </tr>
            </table>

            <p class="font-weight-bold mt-4">Δημιουργία ερωτημάτων με το annotation @Query</p>

            <p>Μπορούμε, να χρησιμοποιήσουμε το annotation <span class="code">@Query</span> στην αντίστοιχη μέθοδο, δηλώνοντας το ερώτημα, που θέλουμε να εκτελεστεί.</p>

            <pre>
                <code>  
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public interface </span> UserRepository <span class="keyword">extends</span> JpaRepository&#60;User, Long&#62;{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Query</span>(<span class="string">"select u from User u where u.emailAddress = ?1"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;User findByEmailAddress(String emailAddress);
                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <p>Εάν το ερώτημα ενημερώνει ή προσθέτει γραμμές σε κάποιο πίνακα της βάσης, τότε χρησιμοποιούμε το annotation  <span class="code">@Modifying</span>.</p>

            <pre>
                <code>  
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Modifying</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Query</span>(<span class="string">"update User u set u.firstname = ?1 where u.lastname = ?2"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;int setFixedFirstnameFor(String firstname, String lastname);
                </code>
            </pre>

            <p>Επίσης, μπορούμε να χρησιμοποιήσουμε το annotation  <span class="code">@Param</span>, για να δώσουμε όνομα σε μια παράμετρο μεθόδου και να κάνουμε bind το όνομα
                στο ερώτημα
            </p>

            <pre>
                <code>  
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public interface </span> UserRepository <span class="keyword">extends</span> JpaRepository&#60;User, Long&#62;{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Query</span>(<span class="string">"select u from User u where u.firstname = :firstname or u.lastname = :lastname""</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;User findByEmailAddress(<span class="annotation">@Param</span>(<span class="string">"lastname"</span>) String lastname,<span class="annotation">@Param</span>(<span class="string">"firstname"</span>) String firstname);
                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <p>Τέλος, το annotation  <span class="code">@Query</span> μας δίνει τη δυνατότητα, να πραγματοποιήσουμε και native ερωτήματα, θέτοντας τη σημαία nativeQuery σε true.</p>

            <pre>
                <code>  
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public interface </span> UserRepository <span class="keyword">extends</span> JpaRepository&#60;User, Long&#62;{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Query</span>( value = <span class="string">"SELECT * FROM USERS WHERE EMAIL_ADDRESS = ?1"</span>, nativeQuery = true)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;User findByEmailAddress(String emailAddress);
                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

        </section>

        <section class="references">

            <h5>Πηγές</h5>

            <ul>
                <li><a href="https://www.tutorialspoint.com/jdbc/index.htm">tutorialpoint : JDBC</a></li>
                <li><a href="https://www.apress.com/la/book/9781484227893">Spring 5 Recipes : A Problem Solution Approach</a></li>
                <li><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html">Spring Framework : Data Access</a></li>
                <li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/">Spring Data JPA - Reference Documentation</a></li>
            </ul>
        </section>
    </div>

  </body>
</html>
