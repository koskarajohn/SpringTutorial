<!DOCTYPE html>
<html>
  <head>
    <title>Spring Data JPA</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/index.css">
    
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
  </head>

  <body>

    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary" id="sideNav">

        <a class="navbar-brand" href="../index.html">
            <span>Learn Spring</span>
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false">
                <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="spring.html">Spring</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-container.html">Spring IoC Container</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-beans.html">Spring Beans</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="dependency-injection.html">Dependency Injection</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="annotations.html">Annotations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-boot.html">Spring Boot</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-mvc.html">Spring MVC</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="rest-api.html">REST API</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="jpa.html">JPA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="spring-data-jpa.html">Spring Data JPA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step2.html">Βημα 2</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step3.html">Βημα 3</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step4.html">Βημα 4</a>
                </li>    
                <li class="nav-item">
                    <a class="nav-link" href="step5.html">Βημα 5</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="step6.html">Βημα 6</a>
                </li>  

            </ul>
        </div>
    </nav>

    <div class="container-fluid content">

        <h1 class="text-center">Spring Data JPA</h1>

        <section class="intro">

            <p>Στις περισσότερες enterprise εφαρμογές, η ανάκτηση πληροφοριών από την βάση δεδομένων είναι συχνή απαίτηση. H Java
                παρέχει το JDBC API, το οποίο μας επιτρέπει, να εκτελούμε SQL εντολές στη βάση δεδομένων. Όμως όταν χρησιμοποιούμε το JDBC,
                πρέπει εμείς, να διαχειριστούμε τους πόρους της βάσης δεδομένων και τα Exceptions, που προκύπτουν κατά την εκτέλεση του κώδικα. Επίσης,
                ο κώδικας είναι αρκετά φλύαρος. Παρακάτω δίνεται ο κώδικας, που εκτελεί ένα SELECT στη βάση δεδομένων:
            </p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> JDBCExample  {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Όνομα JDBC driver και το url της βάσης δεδομένων</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">static final</span>  String JDBC_DRIVER = <span class="string">"com.mysql.jdbc.Driver"</span>;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">static final</span>  String DB_URL = <span class="string">"jdbc:mysql://localhost/database"</span>;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Όνομα χρήστη και κωδικός</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">static final</span>  String USER = <span class="string">"username"</span>;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">static final</span>  String PASS = <span class="string">"password"</span>;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public static void</span> main(String[] args) {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Connection conn = null;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Statement stmt = null;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">try</span>{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;conn = DriverManager.getConnection(DB_URL, USER, PASS);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;stmt = conn.createStatement();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;String sql = <span class="string">"SELECT id, name FROM Categories"</span>;
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;ResultSet rs = stmt.executeQuery(sql);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">while</span>(rs.next()){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;int id  = rs.getInt(<span class="string">"id"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;String name = rs.getString(<span class="string">"name"</span>);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Μετά κάνουμε ότι θέλουμε με τα αποτελέσματα</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;rs.close();

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}<span class="keyword">catch</span>(SQLException se){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;se.printStackTrace();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}<span class="keyword">catch</span>(Exception  e){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;e.printStackTrace();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}<span class="keyword">finally</span>{
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">try</span>{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">if</span>(stmt != <span class="keyword">null</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; stmt.close();

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; <span class="keyword">if</span>(conn != <span class="keyword">null</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; conn.close();

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}<span class="keyword">catch</span>(SQLException se){
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;se.printStackTrace();
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}
                    
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        </section>

        <section class="jpa">

            <h5>JPA</h5>

            <p>Εναλλακτικά, μπορούμε να χρησιμοποιήσουμε το JPA. Το Java Persistance API (JPA) είναι ένα Java specification, μέρος της Java EE, για την ανάκτηση, αποθήκευση και διαχείριση δεδομένων, μεταξύ
                αντικειμένων της Java και της σχεσιακής βάσης δεδομένων. Θεωρείται η πιο standard προσέγγιση για Object to Relational Mapping (ORM)
                στη βιομηχανία της Java.</p>

            <p>To JPA είναι ένα σύνολο από διεπαφές, οι οποίες απαιτούν μια υλοποίηση. Δημοφιλείς υλοποιήσεις είναι το Hibernate, EclipseLink και 
                Apache OpenJPA. Η υλοποίηση του JPA συνήθως λέγεται persistence provider.
            </p>

            <p>Επίσης, επιτρέπει στους developers, να δουλεύουν απευθείας με objects (POJOs), αντί με εντολές SQL. Η αντιστοίχιση των κλάσεων της Java, με 
                τους πίνακες της βάσης δεδομένων πραγματοποιείται με annotations ή XML. Παρακάτω, δίνεται ένα παράδειγμα αποθήκευσης ενός entity στη βάση δεδομένων:
            </p>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Entity</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Table(</span>name = <span class="string">"categories"</span>)
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> Category{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Id</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(</span>name = <span class="string">"id"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private int</span> id;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Column(name = </span><span class="string">"name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@NotNull(</span>message = <span class="string">"Please provide category name"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@Size(</span>min = 3, max = 200, message = <span class="string">"Name must be between 3 and 200 characters"</span>)
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private String</span> name;

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public</span> Category() {

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="comments">//Getters - Setters ...</span>
		
	                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>

            <pre>
                <code>
                    &emsp;&emsp;&emsp;&emsp;<span class="annotation">@Repository</span>
                    &emsp;&emsp;&emsp;&emsp;<span class="keyword">public class</span> CategoryRepositoryImpl{

                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="annotation">@PersistenceContext</span>
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">private </span> EntityManager entityManager;
                    
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="keyword">public void</span> create(Category category) {
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;entityManager.persist(category);
                    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;}

                    &emsp;&emsp;&emsp;&emsp;} 
                </code>
            </pre>
        
        </section>

        <section class="references">

            <h5>Πηγές</h5>

            <ul>
                <li><a href="https://www.tutorialspoint.com/jdbc/index.htm">tutorialpoint : JDBC</a></li>
            </ul>
        </section>
    </div>

  </body>
</html>
